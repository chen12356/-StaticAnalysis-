# 正则解析流程

*注：以下数据只是测试数据*

1. 项目中现存的`url`数据格式：

   ```json
   [
       {
           'urls': 
           [
               'https://api.weibo.cn/2/sdk/login', 'http://api.weibo.cn/2/sdk/login'
           ],   
           'path': 'com/sina/weibo/sdk/network/intercept/GuestParamInterception.java'
       },
       {
           'urls': 
           [
               'data:image/png;base64,'
           ], 
        	'path': 'com/alipay/mobile/nebulax/integration/mpaas/view/a.java'
       }, 
       {
           'urls': 
           [
               'https://service.weibo.com/share/mobilesdk.php',
               'https://service.weibo.com/share/mobilesdk_uppic.php'
           ],
           'path': 'com/sina/weibo/sdk/web/param/ShareWebViewRequestParam.java'
       }
   ]
   ```

2. 进行`url`处理，提取可以访问的地址(如：**http / https** 开头的)，有的以**www**开头的，会自动补全协议(否则代码中不能访问)，得到的数据格式还是 `第1步`格式。

3. 将整理后`url`的数据进行处理：

   - 利用正则匹配，规则如下：

     - 手机号：匹配相应的位数（第一位数以1开头、第二位数以3-9开头，且总共11位数）  
       - 连续的数字总长度如果超过11位数----> 判定不是手机号（不进行正则匹配）
     - 身份证号：分别存在15位 与18位长度的匹配
       - 15位：  15位身份证位纯数字(区号划分6位、年份2位、月份2位、日期2位，顺序码3位)  -->与手机号不同的是（只要在字符串中存在满足15位身份证正则的号码---> 判定为15位身份证）,假如：url中存在17位数，可能满足了15位正则--> 会提取该15位数视为身份证
       - 18位：  18位身份证纯数字/X  ----> 与15号的判定逻辑相同
     - 护照号：包含各类护照号(普通E / G、外交D、公务S、公务普通P) + 8位数字    或者  2个字母 + 7位数字
       - 也是在    整个字符串   中匹配相关的护照号码

   - re匹配成功的url会进行保存，另外也会记录某个`url` 对应的 `path`文件

     - 假设：

       ```json
       处理前：
       [
           {
               'urls':
               [
                   'https://api.weibo.cn/2/sdk/login?l=E18337261829', 
                   'http://api.weibo.cn/2/sdk/login35302020010603181X'
               ],
               'path': 'com/sina/weibo/sdk/network/intercept/GuestParamInterception.java'
           },
           {
               'urls':
               [
                   'https://service.weibo.com/share/mobilesdk.php?x=e235123213'
               ],
            	'path': 'com/alipay/mobile/nebulax/integration/mpaas/view/a.java'
           }
       ]
       
       处理得到结果：
       [
           {
               'urls': 
               [
                   {
                       'phones': ['18337261829'], 
                       'cards': [], 
                       'passports': ['E18337261'], 
                       'url': 'https://api.weibo.cn/2/sdk/login?l=E18337261829'
                   }, 
                   {
                       'phones': [], 
                       'cards': ['35302020010603181X'], 
                       'passports': [], 
                       'url': 'http://api.weibo.cn/2/sdk/login35302020010603181X'
                   }
               ], 
               'path': 'com/sina/weibo/sdk/network/intercept/GuestParamInterception.java'
           }, 
           {
               'urls': 
               [
                   {
                       'phones': [], 
                       'cards': [], 
                       'passports': ['E23512321'], 
                       'url': 'https://service.weibo.com/share/mobilesdk.php?x=e235123213'
                   }
               ], 
               'path': 'com/alipay/mobile/nebulax/integration/mpaas/view/a.java'
           }
       ]
       
       ```

     - | 字段      | 类型 | 说明                                            |
       | --------- | ---- | ----------------------------------------------- |
       | urls      | list |                                                 |
       | phones    | list | 匹配到手机号的结果列表                          |
       | cards     | list | 匹配到15位/18位的身份证号结果列表               |
       | passports | list | 匹配到护照号的结果列表                          |
       | url       | str  | 被匹配的url                                     |
       |           |      |                                                 |
       | path      | str  | 对应urls字段中所有的url对应的path(xxx.java)文件 |

       ***注：邮箱的操作也是一样，进行正则匹配（3类敏感信息），因为   原始的邮箱数据与原始的URL数据   一致的，正则处理邮箱结果与上面一致  (    唯独不同的是：urls变成emails，url变成email    )***

4. 对`url`进行发起请求，解析`response`内容

   + 发起`get`请求可访问的`url`     **当前代码逻辑是访问包含  第3 步 re处理后的url**

   + 响应的状态码为`200`  的`url`响应的内容：`response.text()`   **响应内容： json文件、HTML    ---> 需要解析的内容**    

   + 通过正则去匹配，响应的内容中是否存在类似 ： **手机号、身份证号、护照号**  的 敏感信息

   + **响应的内容中匹配到 敏感信息 ,将记录 敏感信息与 响应内容(response)，将response这个字段追加到urls字段里面url中**

     + 

     | 字段 | 类型 | 说明 |
     | ---- | ---- | ---- |
     |      |      |      |
     |      |      |      |
     |      |      |      |

以上的4个步均已实现